# SLSA Compliance Framework

## Overview

This document outlines our Supply Chain Levels for Software Artifacts (SLSA) compliance implementation for the Gaudi3 Scale project. SLSA is a framework for securing software supply chains by ensuring build integrity and provenance.

## Current SLSA Level: 2

### SLSA Level 2 Requirements ✅

1. **Source - Version controlled**: All source code is stored in Git with signed commits
2. **Build - Scripted build**: Builds are fully scripted via CI/CD pipelines  
3. **Build - Build service**: Builds run on GitHub Actions (hosted build service)
4. **Provenance - Available**: Build provenance is generated and available
5. **Provenance - Authenticated**: Provenance is cryptographically signed
6. **Provenance - Service generated**: Provenance generated by build service

### Implementation Details

#### Source Requirements
- **Repository**: GitHub with branch protection rules
- **Signed commits**: Enforced via GPG signature verification
- **Two-person review**: Required for all changes to main branch
- **Version tags**: Semantic versioning with signed tags

#### Build Requirements
- **Dockerfile**: Multi-stage builds with minimal base images
- **Build isolation**: Each build runs in clean containers
- **Reproducible builds**: Pinned dependencies and deterministic builds
- **Security scanning**: Integrated vulnerability scanning

#### Provenance Requirements
- **SLSA Provenance**: Generated using `slsa-github-generator`
- **Attestation**: Builds include signed attestations
- **SBOM**: Software Bill of Materials generated for all releases
- **Verification**: Provenance can be verified using `slsa-verifier`

## Roadmap to SLSA Level 3

### Additional Requirements for Level 3

1. **Source - Retained indefinitely**: ✅ Already implemented
2. **Build - Isolated**: ✅ Using containerized builds
3. **Build - Parameterless**: ❌ **TODO**: Remove build parameters
4. **Build - Ephemeral environment**: ✅ Using GitHub Actions runners
5. **Provenance - Non-falsifiable**: ❌ **TODO**: Implement hardware attestation

### Implementation Plan

#### Phase 1: Parameterless Builds (Q2 2025)
```yaml
# Remove parameters from build process
- name: Build with fixed configuration
  run: |
    # All build configuration from checked-in files only
    make build-release
```

#### Phase 2: Hardware Attestation (Q3 2025)
- Implement TPM-based attestation for build runners
- Add hardware security module (HSM) for signing
- Integrate with GitHub's sigstore/fulcio

## Implementation Guide

### Setting up SLSA Provenance

1. **Add SLSA Generator to Workflow**:
```yaml
- uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v1.9.0
  with:
    base64-subjects: ${{ needs.build.outputs.digests }}
```

2. **Generate SBOM**:
```yaml
- name: Generate SBOM
  uses: anchore/sbom-action@v0
  with:
    image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
    format: spdx-json
    output-file: sbom.spdx.json
```

3. **Sign Artifacts**:
```yaml
- name: Sign container image
  uses: sigstore/cosign-installer@v3.1.1
- name: Sign image with cosign
  run: cosign sign --yes ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
```

### Verification Instructions

#### Verify Build Provenance
```bash
# Install slsa-verifier
go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@latest

# Verify provenance
slsa-verifier verify-artifact \
  --provenance-path provenance.intoto.jsonl \
  --source-uri github.com/yourusername/gaudi3-scale-starter \
  --source-tag v1.0.0 \
  gaudi3-scale-1.0.0.tar.gz
```

#### Verify Container Images
```bash
# Install cosign
curl -O -L "https://github.com/sigstore/cosign/releases/latest/download/cosign-linux-amd64"
sudo mv cosign-linux-amd64 /usr/local/bin/cosign
sudo chmod +x /usr/local/bin/cosign

# Verify signature
cosign verify --certificate-identity=https://github.com/yourusername/gaudi3-scale-starter/.github/workflows/release.yml@refs/heads/main \
  --certificate-oidc-issuer=https://token.actions.githubusercontent.com \
  ghcr.io/yourusername/gaudi3-scale-starter:v1.0.0
```

## Compliance Monitoring

### Automated Checks
- **Daily**: Verify all release artifacts have valid provenance
- **Weekly**: Audit build logs for compliance violations  
- **Monthly**: Review access controls and permissions
- **Quarterly**: Full SLSA compliance assessment

### Metrics and KPIs
- **Provenance Coverage**: 100% of releases have provenance
- **Signature Verification**: 100% of artifacts are signed
- **Build Reproducibility**: 95% of builds are reproducible
- **Security Scan Results**: 0 critical vulnerabilities in releases

## Integration with Other Frameworks

### OpenSSF Scorecard
- Automated scorecard runs: https://github.com/ossf/scorecard
- Target score: 8.0/10 or higher
- Key areas: Security Policy, Dependency Management, Code Review

### CycloneDX SBOM
- Generate comprehensive SBOMs for all components
- Include transitive dependencies and container layers
- Integrate with dependency tracking systems

### SPDX Compliance
- Use SPDX license identifiers throughout codebase
- Generate SPDX documents for all releases
- Maintain license compliance documentation

## Resources and References

### SLSA Specification
- [SLSA Framework](https://slsa.dev/)
- [SLSA Requirements](https://slsa.dev/spec/v1.0/requirements)
- [GitHub Integration Guide](https://github.com/slsa-framework/slsa-github-generator)

### Tools and Utilities
- [slsa-verifier](https://github.com/slsa-framework/slsa-verifier)
- [cosign](https://github.com/sigstore/cosign)
- [syft](https://github.com/anchore/syft) for SBOM generation
- [grype](https://github.com/anchore/grype) for vulnerability scanning

### Best Practices
- [OpenSSF Secure Supply Chain](https://openssf.org/projects/)
- [NIST Secure Software Development Framework](https://csrc.nist.gov/Projects/ssdf)
- [Supply Chain Security Best Practices](https://github.com/cncf/tag-security/blob/main/supply-chain-security/supply-chain-security-paper/CNCF_SSCP_v1.pdf)